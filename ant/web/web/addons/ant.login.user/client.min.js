(function(e){(function(e,r){var o='style="width: 90%;"';var t={ui:{login_form:{name:"login_form",header:"登录",fields:[{type:"email",field:"email",required:true,html:{caption:"邮箱",attr:o}},{type:"password",field:"password",required:true,html:{caption:"密码",attr:o}}],toolbar:{items:[{id:"login",type:"button",icon:"fa fa-sign-in",caption:"登录",onClick:function(){var r=w2ui["login_form"];if(r.validate().length===0){if(r.record.password.length<6){e("#password").val("").focus();return t.warning("密码长度不得少于6位!")}t.lock("登录中..");e.post("/addons/ant.login.user/login",r.record,function(o){t.unlock();if(o.ret){t.lock("登录成功!跳转中..");localStorage.setItem("login_user",r.record.email);setTimeout(function(){location.reload()},1e3)}else{t.error("登录失败!<br>"+o.err);r.record.password="";e("#password").val("").focus()}})}}},{type:"break"}]},record:{email:localStorage.getItem("login_user")||"",password:""},onRender:function(r){setTimeout(function(){document.getElementById("password").onkeydown=function(r){if(r.keyCode===13){e("#password").blur();w2ui["login_form_toolbar"].click("login")}}},200)}},register_form:{name:"register_form",header:"注册",fields:[{type:"email",field:"email",required:true,html:{caption:"邮箱",attr:o}},{type:"text",field:"nickname",required:true,html:{caption:"昵称",attr:o}},{type:"password",field:"password",required:true,html:{caption:"密码",attr:o}},{type:"password",field:"password1",required:true,html:{caption:"重复密码",attr:o}}],toolbar:{items:[{type:"button",icon:"fa fa-user-plus",caption:"注册",onClick:function(){var r=w2ui["register_form"];if(r.validate().length===0){if(r.record.password.length<6){e("#password").val("").focus();return t.warning("密码长度不得少于6位!")}if(r.record.password!==r.record.password1){e("#password1").val("").focus();return t.warning("两次输入的密码不一致!")}t.lock("注册中..");e.post("/addons/ant.login.user/register",r.record,function(e){t.unlock();if(e.ret){t.success("注册成功!请登录邮箱验证帐号!");localStorage.setItem("login_user",r.record.email);w2ui["sidebar"].click("user_login")}else{t.error("注册失败!<br>"+e.err)}})}}},{type:"break"}]}}},init:function(){e().w2form(this.ui.login_form);e().w2form(this.ui.register_form);ANT.addonLoaded.reg(function(){w2ui["sidebar"].click("user_login")})}};ANT.initAddon({id:"ant_user",text:"加入蚁逅",group:true,expanded:true,nodes:[{id:"user_login",text:"用户登录",icon:"fa fa-user",onClick:function(){t.content(w2ui["login_form"]);e("#password").keydown(function(e){console.log(e.keyCode)})}},{id:"user_register",text:"用户注册",icon:"fa fa-user-plus",onClick:function(){t.content(w2ui["register_form"])}}]},t)})(jQuery)})();